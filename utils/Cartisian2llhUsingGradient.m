function [lat, lon, height] = Cartisian2llhUsingGradient(x,y,z,consParams)
    a = consParams.a;
    f = consParams.f;
    % fistly, convert f to e
    e = sqrt(2*f-f*f);
    e2 = e*e;
    x2y2sqr = sqrt(x*x+y*y);
       
    iter = 1;
    vold = [0,0,0];
    vnew = zeros(1,3);
    tolerance = 1e-6;
    maxIter = 1e6;
    
    while iter < maxIter
        disp(strcat('iter:',num2str(iter)));
        N = a / sqrt(1-e2*sin(vold(1))*sin(vold(1)));
        % update
        vnew(1) = atan2(z, x2y2sqr*(1-e2*N/(N+vold(3)+1e-6)));
        vnew(2) = atan2(y,x);
        vnew(3) = x2y2sqr/cos(vnew(1)) - N;
        % check tolerance
        verr = vnew - vold;
        if norm(verr) < tolerance
            break;
        else
            vold = vnew;
            iter = iter + 1;
        end
    end
    % to deg
    lat = rad2deg(vnew(1));
    lon = rad2deg(vnew(2));
    height = vnew(3);
end

function [gx,gy,gz] = gradient(phi, lambda, h, x, y, z)

gx = 2*((313976965065521127437670051455*cos(phi)*sin(phi))/(1152921504606846976*(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(3/2)) - (sin(phi)*(x^2 + y^2)^(1/2))/cos(phi)^2)*(h - (x^2 + y^2)^(1/2)/cos(phi) + 40680631590769/(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2)) + 2*(phi - atan2(z, -(x^2 + y^2)^(1/2)*(313976965065521127437670051455/(1152921504606846976*(h + 40680631590769/(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2))*(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2)) - 1)))*((z*(x^2 + y^2)^(1/2)*((98581534591755474476808756995172867392514253510622347617025*cos(phi)*sin(phi))/(1329227995784915872903807060280344576*(h + 40680631590769/(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2))^2*((7718094650643695*sin(phi)^2)/1152921504606846976 - 1)^2) - (2423303934497540915666500054726051239521326225*cos(phi)*sin(phi))/(1329227995784915872903807060280344576*(h + 40680631590769/(1 - (7718094650643695*sin(phi)^2)/115292150460\\\n6846976)^(1/2))*(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(3/2))))/((x^2 + y^2)*(313976965065521127437670051455/(1152921504606846976*(h + 40680631590769/(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2))*(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2)) - 1)^2 + z^2) + 1)
 
2*lambda - 2*atan2(y, x)
 
2*h - (2*(x^2 + y^2)^(1/2))/cos(phi) + 81361263181538/(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2) + (313976965065521127437670051455*z*(x^2 + y^2)^(1/2)*(phi - atan2(z, -(x^2 + y^2)^(1/2)*(313976965065521127437670051455/(1152921504606846976*(h + 40680631590769/(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2))*(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2)) - 1))))/(576460752303423488*(h + 40680631590769/(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2))^2*((x^2 + y^2)*(313976965065521127437670051455/(1152921504606846976*(h + 40680631590769/(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2))*(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2)) - 1)^2 + z^2)*(1 - (7718094650643695*sin(phi)^2)/1152921504606846976)^(1/2))
end



