function test_fast_multi_constellation_dop_computation

    ha = [-0.6257 -0.2565 -0.7366];
    hb = [-0.6928  0.5700  0.4417];
    hc = [-0.3920  0.4136 -0.8218];
    hd = [ 0.8162  0.2524 -0.5197];
    he = [ 0.1250  0.6302  0.7663];

    H{1} = [ha [1 0]; ...
          hb [1 0]; ...
          hc [1 0]; ...
          hd [0 1]; ...
          he [0 1]];
      
    H{2} = [ha [1 0]; ...
          hb [1 0]; ...
          hd [1 0]; ...
          hc [0 1]; ...
          he [0 1]];
      
    H{3} = [ha [1 0]; ...
          hb [1 0]; ...
          he [1 0]; ...
          hc [0 1]; ...
          hd [0 1]];
      
    H{4} = [ha [1 0]; ...
          hc [1 0]; ...
          hd [1 0]; ...
          hb [0 1]; ...
          he [0 1]];
      
    H{5} = [ha [1 0]; ...
          hc [1 0]; ...
          he [1 0]; ...
          hb [0 1]; ...
          hd [0 1]];

    H{6} = [ha [1 0]; ...
          hd [1 0]; ...
          he [1 0]; ...
          hb [0 1]; ...
          hc [0 1]];
      
    H{7} = [hb [1 0]; ...
          hc [1 0]; ...
          hd [1 0]; ...
          ha [0 1]; ...
          he [0 1]];
      
    H{8} = [hb [1 0]; ...
          hc [1 0]; ...
          he [1 0]; ...
          ha [0 1]; ...
          hd [0 1]];

    H{9} = [hb [1 0]; ...
          hd [1 0]; ...
          he [1 0]; ...
          ha [0 1]; ...
          hc [0 1]];
      
    H{10} = [hc [1 0]; ...
          hd [1 0]; ...
          he [1 0]; ...
          ha [0 1]; ...
          hb [0 1]];      

    dop1 = zeros(10,1);
    dop2 = zeros(10,1);
    dop3 = zeros(10,1);

    t1s = zeros(10,1);
    t2s = zeros(10,1);
    t3s = zeros(10,1);

    for i = 1:10
        tic
        dop1(i) = dop_by_inverse(H{i});
        t1s(i) = toc;
        tic
        dop2(i) = dop_by_cl1(H{i});
        t2s(i) = toc;
        tic
        dop3(i) = dop_by_eig(H{i});
        t3s(i) = toc;
    end
    
    sum(t1s)
    sum(t2s)
    sum(t3s)
end

function dop = dop_by_eig(H)
    e = eig(H'*H);
    dop = sqrt(sum(1./e));
end

function dop = dop_by_inverse(H)
    dop = sqrt(trace(inv(H'*H)));
end

function dop = dop_by_cl1(H)
    M = H*H';
    A = sum(M(1,2:end).^2)+sum(M(2,3:end).^2)+sum(M(3,4:end).^2)+sum(M(4,5:end).^2);
    B = M(1,2)*(M(1,3)*M(2,3)+M(1,4)*M(2,4)+M(1,5)*M(2,5)) + ...
        M(1,3)*(M(1,4)*M(3,4)+M(1,5)*M(3,5)) + ...
        M(2,3)*(M(2,4)*M(3,4)+M(2,5)*M(3,5)) + ...
        M(4,5)*(M(1,4)*M(1,5)+M(2,4)*M(2,5)+M(3,4)*M(3,5));
    
    C = (M(2,4)*M(3,5)+M(2,5)*M(3,4)-M(2,3)*M(4,5))^2 + ...
        (M(1,3)*M(4,5)+M(1,4)*M(3,5)-M(1,5)*M(3,4))^2 + ...
        (M(1,3)*M(2,4)+M(1,4)*M(2,3)-M(1,2)*M(3,4))^2 + ...
        (M(1,3)*M(2,5)+M(1,5)*M(2,3)-M(1,2)*M(3,5))^2 + ...
        (M(1,4)*M(2,5)+M(1,5)*M(2,4)-M(1,2)*M(4,5))^2 - ...
        (M(1,3)*M(1,4)*(M(2,3)*M(2,4)+M(3,5)*M(4,5))+M(1,5)*M(2,5)*(M(1,3)*M(2,3)+M(1,4)*M(2,4))+M(2,4)*M(2,5)*M(3,4)*M(3,5))*4;
    
    dop = sqrt(80-12*A+8*B+C)/abs(det([H(1,1:3)-H(3,1:3);H(2,1:3)-H(3,1:3);H(4,1:3)-H(5,1:3)]));
end